<!DOCTYPE html>
<html>
  <head>
    <title>Embed - WebX Viewer</title>
    <link rel="icon" href="./favicon.ico" type="image/png">
    <link rel="stylesheet" href="./media/embed.css">
    <script>
      // Set immediate polyfill
      (() => {
        if (window.setImmediate) return;
        let h = 1, tasks = {};
        const chan = new MessageChannel();
        chan.port1.onmessage = e => {
          const t = tasks[e.data];
          if (t) t(), delete tasks[e.data];
        };
        window.setImmediate = (cb, ...a) => {
          const id = h++;
          tasks[id] = () => cb(...a);
          chan.port2.postMessage(id);
          return id;
        };
        window.clearImmediate = id => delete tasks[id];
      })();
    </script>
    <script src="./media/wasmoon/index.js"></script>
  </head>
  <body>
    <div style="display:none" aria-hidden="true" inert>
      <input id="url">
      <input id="bussinga" type="checkbox">
      <input id="proxy" type="checkbox">
      <input id="dns">
      <script>
        let query = {};
        location.search.replace('?','').split('&').forEach(p=>query[p.split('=')[0]]=p.split('=')[1]);
        document.getElementById('url').value = query.url??'';
        document.getElementById('bussinga').checked = query?.bussinga?.toLowerCase()==='true';
        document.getElementById('proxy').checked = query?.proxy?.toLowerCase()==='true';
        document.getElementById('dns').value = query.dns??'https://dns.webxplus.org/';
      </script>
    </div>
    <iframe sandbox="allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-scripts allow-same-origin"></iframe>
    <script src="./media/script.js" type="module"></script>
    <script type="module">
      window.urlhistory = [document.getElementById('url').value];
      window.current = 0;
      window.view();
    </script>
  </body>
</html>